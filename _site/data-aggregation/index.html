<!DOCTYPE html><html domain=.com lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="default-src 'self';object-src 'none';script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com/;style-src 'self' https://fonts.googleapis.com/ https://use.fontawesome.com/ 'unsafe-inline';img-src 'self' data:;font-src 'self' https://fonts.gstatic.com/ https://use.fontawesome.com/" http-equiv=Content-Security-Policy><link href=/favicon.svg rel=icon type=image/svg+xml><meta content=#f9c412 name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>Data Aggregation</title><meta content="Data Aggregation" property=og:title><meta content="In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..." name=description><meta content="In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@dinhanhthi name=twitter:site><meta content=@dinhanhthi name=twitter:creator><meta content=/img/header/aggregation.png property=og:image><link href=https://dinhanhthi.com/data-aggregation/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="ðŸ”¥ Anh-Thi DINH"><link href=/ rel=preconnect crossorigin=""><script src="/js/min.js?hash=70bdd86fac" async defer></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))
      document
        .documentElement
        .classList
        .add('apple')</script><style>@charset "UTF-8";@font-face{font-display:swap;font-family:"Poppins";font-style:normal;font-weight:400;src:url(/fonts/poppins/poppins-v15-latin-regular.eot);src:local("Poppins Regular"),local("Poppins-Regular"),url(/fonts/poppins/poppins-v15-latin-regular.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins/poppins-v15-latin-regular.woff2) format("woff2"),url(/fonts/poppins/poppins-v15-latin-regular.woff) format("woff"),url(/fonts/poppins/poppins-v15-latin-regular.ttf) format("truetype"),url(/fonts/poppins/poppins-v15-latin-regular.svg#Poppins) format("svg")}@font-face{font-display:swap;font-family:"Poppins";font-style:italic;font-weight:400;src:url(/fonts/poppins/poppins-v15-latin-italic.eot);src:local("Poppins Italic"),local("Poppins-Italic"),url(/fonts/poppins/poppins-v15-latin-italic.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins/poppins-v15-latin-italic.woff2) format("woff2"),url(/fonts/poppins/poppins-v15-latin-italic.woff) format("woff"),url(/fonts/poppins/poppins-v15-latin-italic.ttf) format("truetype"),url(/fonts/poppins/poppins-v15-latin-italic.svg#Poppins) format("svg")}@font-face{font-display:swap;font-family:'Poppins';font-style:normal;font-weight:600;src:url(/fonts/poppins/poppins-v15-latin-600.eot);src:local("Poppins SemiBold"),local("Poppins-SemiBold"),url(/fonts/poppins/poppins-v15-latin-600.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins/poppins-v15-latin-600.woff2) format("woff2"),url(/fonts/poppins/poppins-v15-latin-600.woff) format("woff"),url(/fonts/poppins/poppins-v15-latin-600.ttf) format("truetype"),url(/fonts/poppins/poppins-v15-latin-600.svg#Poppins) format("svg")}@font-face{font-display:swap;font-family:'Poppins';font-style:italic;font-weight:600;src:url(/fonts/poppins/poppins-v15-latin-600italic.eot);src:local("Poppins SemiBold Italic"),local("Poppins-SemiBoldItalic"),url(/fonts/poppins/poppins-v15-latin-600italic.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins/poppins-v15-latin-600italic.woff2) format("woff2"),url(/fonts/poppins/poppins-v15-latin-600italic.woff) format("woff"),url(/fonts/poppins/poppins-v15-latin-600italic.ttf) format("truetype"),url(/fonts/poppins/poppins-v15-latin-600italic.svg#Poppins) format("svg")}@font-face{font-display:swap;font-family:'Recoleta';src:url(/fonts/recoleta/Recoleta-Bold.woff2) format("woff2"),url(/fonts/recoleta/Recoleta-Bold.woff) format("woff"),url(/fonts/poppins/Recoleta-Bold.ttf) format("truetype");font-weight:700;font-style:bold}*{border:0;box-sizing:border-box}:root{font-size:16.5px}main img{content-visibility:auto}::-webkit-scrollbar{height:10px;width:10px}::-webkit-scrollbar-thumb{background:#3e466b;border-radius:6px}::-webkit-scrollbar-thumb:hover{background:#aaa;cursor:pointer}::-webkit-scrollbar-track{background:#363948}::-webkit-scrollbar-corner{background:#282a36}body,html{font-family:"Poppins",Arial,Helvetica,sans-serif;font-size:16.5px}html{-webkit-text-size-adjust:100%}@supports (font-variation-settings:normal){html{font-family:"Poppins" var alt,Arial,Helvetica,sans-serif}}body{background:#282a36;color:#eee;margin:0;counter-reset:h2counter}b,strong{font-weight:600;color:#8cc8ff}sup{top:-.5em}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}a,a:hover{text-decoration:none}a:hover{border-bottom:2px solid #ffd479;color:#fff}a.no-effect:hover{border-bottom:none}img{max-width:100%}main{margin:0 auto}.page-note>h2,h1,h2{font-family:"Recoleta",Arial,Helvetica,sans-serif;font-size:24.75px}.page-note>h2,h1{font-size:29.7px}.page-note>h2{color:#eee;font-size:24.75px;margin:37.125px 0 19.8px}.page-note>h2:hover .direct-link{display:inline-block}.page-note>h2:hover a:hover,a{color:#ffd479}.page-note .direct-link{display:none;color:#777;border-bottom:none;margin-left:3px}.page-note pre+h2{margin-top:37.125px}.page-note h1{counter-reset:h2counter}.page-note h2{counter-reset:h3counter}.page-note h2:before{content:counter(h2counter) ".Â Â ";counter-increment:h2counter;color:#8cc8ff}.container,header{width:100%;margin:0 auto}.normal{padding:0 16.5px;width:100%}@media (min-width:916.5px){.normal{width:900px}}.mt-2{margin-top:2rem}.page-index .container{padding:2rem 1rem 0}.page-index .main-cats{flex:0 1 calc(100% - 280px);padding-right:1rem}.page-index .main-cats>.category-wrapper{padding-bottom:1.5rem}.page-index .main-cats>.category-wrapper>.category{border:1px solid #3b3e54;border-radius:7px;height:fit-content;background:#2f3240;padding:2rem 1.5rem 1.5rem}.page-index .toc-index{border:1px solid #404040;border-radius:7px;height:fit-content;background:#35373c;flex:0 1 280px;position:sticky;top:60px;padding:1rem 1.1rem}.page-index .toc-index h3{padding-bottom:5px;border-bottom:1px solid #555;margin:0 0 10px;font-size:1.3rem}.page-index .toc-index ul{padding-left:20px;margin:0}.page-index .toc-index p{font-style:italic;color:#999;padding-top:0;margin-bottom:0;font-size:.95rem;margin-top:10px}.page-index .toc-index p a{color:#999;border-bottom:2px solid #999}.page-index .toc-index p a:hover{border-bottom:2px solid #ffd479}@media (max-width:991px){.page-index .main-cats{flex:1 1 100%;order:2;padding-right:0}.page-index .toc-index{flex:1 1 100%;order:1;position:inherit;margin-bottom:1.5rem}.page-index .toc-index ul{column-count:3;-webkit-column-count:3;-moz-column-count:3}}@media (max-width:767px){.page-index .toc-index ul{column-count:2;-webkit-column-count:2;-moz-column-count:2}}@media (max-width:575px){.page-index .toc-index ul{column-count:1;-webkit-column-count:1;-moz-column-count:1}}.category{width:100%}.category h2,header h1{font-size:1.55rem;margin-top:0}.category h2 img{float:left;margin-right:7px}.category .list-homepage{list-style:none;padding-left:10px;margin-bottom:0;column-count:1;-webkit-column-count:1;-moz-column-count:1}@media (min-width:768px){.category .list-homepage{column-count:2;-webkit-column-count:2;-moz-column-count:2}}@media (min-width:992px){.category .list-homepage{column-count:3;-webkit-column-count:3;-moz-column-count:3}}.category .list-homepage li{padding-left:15px;margin-bottom:10px;display:inline-block;width:100%}.category .list-homepage li a{color:#ddd;border-bottom:2px solid rgba(255,255,255,.14);border-style:dotted}.category .list-homepage li::before{content:"ðŸ“„";margin-right:5px;margin-left:-25px;opacity:.8}.category .list-homepage li:hover{cursor:pointer}.category .list-homepage li:hover a{border-color:#ffd479;color:#fff}.category .list-homepage li:hover::before{opacity:1}.page-index header{padding-top:5em;padding-bottom:0}.page-index header .header-logo{height:80px;width:auto}header nav{z-index:10}#nav{z-index:2;position:relative}header{padding:5.5rem 1.5rem 1rem;width:900px;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header h1{font-size:2.2rem;margin-bottom:0}header p{margin-top:1rem}header .header-logo{width:55px;height:55px;margin-bottom:1rem}header .header-logo img{width:100%;height:100%}header .social{margin-top:.5rem}header #more-info #note-tag>a,header .social a{margin-right:10px}header .social a:last-child{margin-right:0}@media (min-width:992px){header .social a{margin-right:20px}}header .social a img{border-radius:50%}header #more-info{padding:1rem}header #more-info #note-tag{padding-bottom:10px;border-bottom:1px solid #444}header #more-info #note-tag>a::before{content:"#"}header #more-info #last-modified{padding-top:10px;font-style:italic}#reading-progress,nav{top:0;left:0;width:100vw}#reading-progress{z-index:3;border-bottom:1px solid #ffd479;position:absolute;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}.intro,.job span{font-size:1.02rem}.intro b,.intro strong{color:#ffd479;font-weight:400}.intro a,footer a:hover{color:#fff}.job span{background:#ffd479;color:#000;padding:3px 10px;border-radius:15px}nav{position:fixed;padding:0 1.5em;background:#35373c}@media (max-width:992px){nav{padding:0 1em}}@media (max-width:576px){nav{padding:0 .5em}}nav #nav{display:-ms-flexbox;-ms-flex-align:center;align-items:center}nav #nav a{color:#ccc;margin-right:15px;align-items:center;padding:0 .5rem;font-size:1.1rem;white-space:nowrap}nav #nav a img{margin-right:5px}nav #nav a:hover{color:#fff;cursor:pointer;text-decoration:none}nav #nav .nav-item{text-align:left;margin-right:5px}@media (min-width:421px){nav #nav .nav-item{padding-left:0!important}}@media (max-width:575px){nav #nav .nav-item{width:unset!important}nav #nav .nav-item span{display:none}}@media (min-width:576px){nav #nav .nav-item{margin-right:15px}}nav #nav .nav-github{text-align:right;padding-right:0!important;margin-right:0!important}nav #nav .nav-search{display:block;background-image:linear-gradient(to right,#3d4251,#3b3f4c,#393d46,#373a41,#35373c);width:100%;position:relative}nav #nav,nav #nav .nav-search form,nav #nav a{display:flex}nav #nav .nav-search .nav-search-input{border:0;background:0 0;color:#ddd;font-size:1.05rem;padding:.65rem .5rem;width:100%}nav #nav .nav-search .nav-search-input:focus{outline:0;border:0}nav #nav .nav-search #search-result{position:absolute;max-height:80vh;overflow:auto;width:100%;background:#35373c;border-bottom-right-radius:5px;border-bottom-left-radius:5px;padding:0 1rem}@media (max-width:767px){nav #nav .nav-search #search-result{position:fixed;left:0;right:0;border-radius:0}}nav #nav .nav-search #search-result ul#searchResults{padding:0 0 0 20px}.page-note ol li,.page-note ul li,div.toc ol li,nav #nav .nav-search #search-result ul#searchResults li h3{margin-bottom:5px}nav #nav .nav-search #search-result ul#searchResults li h3 a{color:#efb232;white-space:inherit;padding:0;text-align:left;font-weight:400;font-size:16.5px;font-family:"Poppins",Arial,Helvetica,sans-serif;line-height:1.4}nav #nav .nav-search #search-result ul#searchResults li h3 a:hover{border-bottom:none;color:#8cc8ff}nav #nav .nav-search #search-result ul#searchResults li p{text-align:left;margin-top:0;line-height:1.4}nav #nav .nav-search #search-result #noResultsFound p{text-align:left}footer{font-size:1.1rem;background:#35373c;padding:.75rem 1rem;text-align:center;margin-top:3rem}footer a{color:#ccc}@media (min-width:768px){.col-2-flex{display:flex;align-items:stretch;flex-wrap:nowrap}.col-2-flex>*{flex:1 1 auto;max-width:auto;overflow:auto;margin-right:10px}.col-2-flex>:nth-child(even){padding-left:5px}.col-2-flex>:nth-child(odd){padding-right:5px}.col-2-flex>*>code{height:100%}.col-2-flex+h2{margin-top:12.375px}.col-2-flex>:last-child{margin-right:0}}.hsbox{margin-bottom:24.75px;border:1px solid #969696;padding:1rem;border-radius:3px}.hsbox .hs__title{cursor:pointer}.hsbox .hs__title::before{content:" ";display:inline-block;border-top:7px solid transparent;border-bottom:7px solid transparent;border-left:7px solid currentColor;vertical-align:middle;margin-right:.7rem;transform:translateY(-2px);transition:transform .2s ease-out}.hsbox .hs__title.show{padding-bottom:15px;border-bottom:.5px solid #666;margin-bottom:1rem}.hsbox .hs__title.show+.hs__content{display:block;opacity:1;padding:5px 0;transition:all .25s 0s cubic-bezier(.4,0,.2,1)}.hsbox .hs__title.show::before{transform:rotate(90deg) translateX(-3px)}.hsbox .hs__content{display:none;transition:all .2s 0s ease}.hsbox .hs__content>:last-child{margin-bottom:0}table{width:100%;max-width:100%;margin-bottom:24.75px;background-color:transparent;border-spacing:0;border-radius:3px;padding:0!important;table-layout:fixed;overflow:hidden;font-size:.95rem;border:1px solid #888}table th{font-weight:400;color:#8cc8ff;text-align:left}table thead>tr:first-child>th:first-child{border-top-left-radius:5px}table thead>tr:first-child>th:last-child{border-top-right-radius:5px}table td,table th{border-bottom:1px solid #444;padding:5px 7px}table tbody>tr:nth-child(odd){background:#2f3240}table tbody>tr:last-child{border-bottom:none}.page-note .text-center{text-align:center}.page-note ol,.page-note p,.page-note ul{margin-top:0;margin-bottom:24.75px}.page-note p+ol,.page-note p+ul{margin-top:-.5rem}.page-note ol li ol,.page-note ol li ul,.page-note ul li ol,.page-note ul li ul{margin-bottom:5px;padding-left:20px}.page-note ol li>*,.page-note ul li>*{margin-bottom:10px}.page-note p.noindent{display:none;padding-left:20px}.page-note p.noindent+ol,.page-note p.noindent+ul{padding-left:20px}.page-note p.indent{display:none;padding-left:40px}.page-note ol.indent,.page-note p.indent+ol,.page-note p.indent+ul,.page-note ul.indent{padding-left:40px}.page-note ol.noindent,.page-note ul.noindent{padding-left:20px}.page-note hr{border-bottom:1px solid #676767;margin-bottom:24.75px}#reading-list .item .author{font-style:italic}#reading-list .item .intro{color:#999}code[class*=language-],pre[class*=language-]{color:#eee;font-size:16px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#75a7ca}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}.token.comment{color:#6a9955}.token.punctuation{color:#eee}.token.inserted,.token.number{color:#b5cea8}.token.builtin,.token.string{color:#ce9178}.token.operator{color:#eee}.token.keyword{color:#90cdff}.token.function{color:#efefac}.token.boolean{color:#90cdff}.token.property,.token.variable{color:#9cdcfe}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}code,pre{font-family:Consolas,Menlo,Monaco,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L","Courier New",Courier,monospace;line-height:1.5}h2>code{font-size:21.78px!important}:not(pre)>code{border:1px solid #444;background:#6b444245;padding:2px 4px;margin:0 1px;border-radius:3px;font-size:.9rem;color:#fff;word-break:break-word}h2>code{color:#ddd;padding-right:6px}a>code{color:#ffd479}a:hover>code{color:#ccc}pre,pre[class*=language-]{margin:0 0 27.225px;overflow:auto}pre>code,pre[class*=language-]>code{display:block;padding:14.5px 16.5px 16.5px;background:#2f3240;border:.5px solid #3b3e54;overflow:auto;border-radius:3px;max-height:450px}div.toc{margin-bottom:24.75px;border:1px solid #3b3e54;border-radius:7px;height:fit-content;background:#2f3240;padding:15px 15px 10px 0}div.toc>ol::before{content:"In this note";display:block;padding-bottom:5px;border-bottom:1px solid #555;margin:0 0 15px;font-size:1.18rem;font-family:"Recoleta",Arial,Helvetica,sans-serif}div.toc ol{padding-left:20px;font-size:14.85px;margin-bottom:0}div.toc ol li code{font-size:.85rem;background:#ececec;padding:0 4px 2px}div.toc ol li ol{padding-left:10px;margin-top:7px}div.toc ol,div.toc ol ol{counter-reset:item;list-style-type:none}div.toc ol li::before{content:counters(item,".") ". ";counter-increment:item}div.toc>ol>li ol>li::before{opacity:.7}div.toc>ol>li::before{color:#8cc8ff}@media (min-width:1300px){div.toc{float:right;margin-right:-280px;border-left:none;width:250px;position:-webkit-sticky;position:sticky;top:60px;max-height:70vh;overflow:auto}div.toc ol{margin-top:0;margin-bottom:0}}@media (min-width:1500px){div.toc{margin-right:-310px;width:280px}}.toc-active>a{color:#fff!important}.toc-active::before{opacity:1!important}.page-note img{height:auto;width:100%}@media (min-width:768px){.page-note .img-90{width:90%;margin-left:auto;margin-right:auto;display:block}}.page-note p>img+br{display:none}.page-note p>img+br+em{display:block;text-align:center;margin-top:10px}</style><header><nav><div id=nav><a href=/ class="nav-item no-effect"><img alt=home src=/img/nav/home.svg height=18 width=18> <span>Thi</span> </a><a href=/about/ class="nav-item no-effect"><img alt=about src=/img/nav/about.svg height=15 width=15> <span>About</span></a><div class=nav-search><form><input aria-label="search notes..." class=nav-search-input id=searchField placeholder="search notes..." type=search></form><div id=search-result style="display: none;"><ul id=searchResults></ul><div id=noResultsFound style="display: none;"><p>No results found.</div></div></div><a href=https://github.com/dinhanhthi class="nav-item no-effect nav-github" target=_blank><img alt=github src=/img/nav/github.svg height=20 width=20></a></div><div id=reading-progress aria-hidden=true></div></nav><div class=header-logo><img alt="Data Aggregation" src=/img/header/aggregation.png></div><h1>Data Aggregation</h1><div id=more-info><div id=note-tag><a href=/tags/data-science>Data Science</a></div><div id=last-modified>28-11-2020 / <a href=https://github.com/dinhanhthi/dinhanhthi.com/edit/dev/./posts/data-science/2019-12-07-data-aggregation.md>Edit on Github</a></div></div></header><main><article><div class="container mt-2 normal page-note"><div class=toc><ol><li><a href=#libraries>Libraries</a><li><a href=#dataframe>Dataframe</a><li><a href=#group-dataset-using-groupby()>Group dataset using groupby()</a><li><a href=#group-using-pivot_table()>Group using pivot_table()</a><li><a href=#reorganizing-df-using-pivot()>Reorganizing df using pivot()</a><li><a href=#change-shape-of-df-with-melt()>Change shape of df with melt()</a><li><a href=#references>References</a></ol></div><p>In this note, I use <code>df</code> for <code>DataFrame</code>, <code>s</code> for <code>Series</code>.<h2 id=libraries>Libraries <a href=#libraries class=direct-link>#</a></h2><pre class=language-python><code class=language-python><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd <span class="token comment"># import pandas package</span><br><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</code></pre><h2 id=dataframe>Dataframe <a href=#dataframe class=direct-link>#</a></h2><pre class=language-python><code class=language-python>dataquest_aio <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/dinhanhthi/dataquest-aio/master/step-2-data-analysis-and-visualization/'</span><br>dataset_url <span class="token operator">=</span> dataquest_aio <span class="token operator">+</span> <span class="token string">'course-4-data-cleaning-and-analysis/data/World_Happiness_2015.csv'</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>dataset_url<span class="token punctuation">)</span> <span class="token comment"># read the data set</span><br>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th>Country<th>Region<th>Happiness Rank<th>Happiness Score<th>Standard Error<tbody><tr><th>0<td>Switzerland<td>Western Europe<td>1<td>7.587<td>0.03411<tr><th>1<td>Iceland<td>Western Europe<td>2<td>7.561<td>0.04884<tr><th>2<td>Denmark<td>Western Europe<td>3<td>7.527<td>0.03328<tr><th>3<td>Norway<td>Western Europe<td>4<td>7.522<td>0.03880<tr><th>4<td>Canada<td>North America<td>5<td>7.427<td>0.03553</table><h2 id=group-dataset-using-groupby()>Group dataset using <code>groupby()</code> <a href=#group-dataset-using-groupby() class=direct-link>#</a></h2><p>Group <code>df</code> by column <code>Region</code> and then selct the column <code>Western Europe</code>,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_group<span class="token punctuation">(</span><span class="token string">'Western Europe'</span><span class="token punctuation">)</span> <span class="token comment"># returns a df</span></code></pre><table><thead><tr><th><th>Country<th>Region<th>Happiness Rank<th>Happiness Score<th>Standard Error<tbody><tr><th>0<td>Switzerland<td>Western Europe<td>1<td>7.587<td>0.03411<tr><th>1<td>Iceland<td>Western Europe<td>2<td>7.561<td>0.04884<tr><th>2<td>Denmark<td>Western Europe<td>3<td>7.527<td>0.03328<tr><th>3<td>Norway<td>Western Europe<td>4<td>7.522<td>0.03880<tr><th>5<td>Finland<td>Western Europe<td>6<td>7.406<td>0.03140</table><p>Select just the <code>Happiness Score</code> column and then find the <code>mean</code>,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'Region'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'Happiness Score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token comment"># other methods: size, max, min, count</span></code></pre><pre><code>Region
Australia and New Zealand          7.285000
Central and Eastern Europe         5.332931
Eastern Asia                       5.626167
Latin America and Caribbean        6.144682
Middle East and Northern Africa    5.406900
North America                      7.273000
Southeastern Asia                  5.317444
Southern Asia                      4.580857
Sub-Saharan Africa                 4.202800
Western Europe                     6.689619
Name: Happiness Score, dtype: float64
</code></pre><p>Apply multiple/custom functions,<pre class=language-python><code class=language-python><span class="token keyword">def</span> <span class="token function">max_min</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">:</span><br>  <span class="token keyword">return</span> group<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> group<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">,</span> max_min<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th><th colspan=3 halign=left>Happiness Rank<th colspan=3 halign=left>Happiness Score<tr><th><th><th>mean<th>amax<th>max_min<th>mean<th>amax<th>max_min<tr><th>Country<th>Region<th><th><th><th><th><th><tbody><tr><th>Afghanistan<th>Southern Asia<td>153<td>153<td>0<td>3.575<td>3.575<td>0.0<tr><th>Albania<th>Central Europe<td>95<td>95<td>0<td>4.959<td>4.959<td>0.0<tr><th>Algeria<th>Middle Africa<td>68<td>68<td>0<td>5.605<td>5.605<td>0.0</table><p>If you wanna apply different functions on different columns,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token string">'Happiness Rank'</span><span class="token punctuation">:</span> max_min<span class="token punctuation">,</span><br>    <span class="token string">'Happiness Score'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token string">'Standard Error'</span><span class="token punctuation">:</span> <span class="token string">'count'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre><table><thead><tr><th><th><th>Happiness Rank<th colspan=2 halign=left>Happiness Score<tr><th><th><th>max_min<th>min<th>max<tr><th>Country<th>Region<th><th><th><tbody><tr><th>Afghanistan<th>Southern Asia<td>0<td>3.575<td>3.575<tr><th>Albania<th>Central Europe<td>0<td>4.959<td>4.959<tr><th>Algeria<th>Middle Africa<td>0<td>5.605<td>5.605</table><p>Or using <code>apply</code> and <code>lambda</code> function,<pre class=language-python><code class=language-python>orders<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'shoes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id=group-using-pivot_table()>Group using <code>pivot_table()</code> <a href=#group-using-pivot_table() class=direct-link>#</a></h2><p><img alt="An example of pivotting by a single column" src=/img/post/data/data-aggregation/pivoting_table_simple1.png class=img-90><br><em>An example of pivotting by a single column<sup><a href=https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/ >[ref]</a></sup></em><p>Group by <code>Region</code> (as an index) and choosing <code>GDP</code> and <code>City</code> columns,<sup><a href=https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token string">'Region'</span><span class="token punctuation">)</span> <span class="token comment"># returns df</span></code></pre><table><thead><tr><th><th>Happiness Rank<th>Standard Error<tr><th>Region<th><th><tbody><tr><th>Australia and New Zealand<td>9.5<td>0.037270<tr><th>Central and Eastern Europe<td>79.0<td>0.045208<tr><th>Eastern Asia<td>64.5<td>0.037225</table><p>Apply some functions,<pre class=language-python><code class=language-python>df<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GDP'</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'Region'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">]</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><br><span class="token comment"># margins shows the "All" row</span></code></pre><table><thead><tr><th><th colspan=2 halign=left>mean<th colspan=2 halign=left>amax<tr><th><th>Happiness Rank<th>Standard Error<th>Happiness Rank<th>Standard Error<tr><th>Region<th><th><th><th><tbody><tr><th>Australia and New Zealand<td>9.5<td>0.037270<td>10<td>0.04083<tr><th>Central and Eastern Europe<td>79.0<td>0.045208<td>134<td>0.06913<tr><th>Eastern Asia<td>64.5<td>0.037225<td>100<td>0.05051</table><h2 id=reorganizing-df-using-pivot()>Reorganizing df using <code>pivot()</code> <a href=#reorganizing-df-using-pivot() class=direct-link>#</a></h2><p><img alt="An example of multi-column pivoting" src=/img/post/data/data-aggregation/pivoting_simple_multicolumn.png class=img-90><br><em>An example of multi-column pivoting (<a href=https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/ >ref</a>)</em><p>Make values in one columns be columns in a new "pivot" table,<sup><a href=https://github.com/dinhanhthi/data-science-learning/blob/master/codecademy-data-science/course-10%20Data%20Analysis%20with%20Pandas/Aggregates%20in%20Pandas.ipynb target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span><br>                           <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'bar'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'baz'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>                   <span class="token string">'zoo'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>pivot_1 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'baz'</span><span class="token punctuation">)</span><br>pivot_2 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">]</span><br>pivot_3 <span class="token operator">=</span> df<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'foo'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'zoo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> pivot_1<span class="token punctuation">,</span> pivot_2<span class="token punctuation">,</span> pivot_3<span class="token punctuation">)</span></code></pre><table><thead><tr><th><th>foo<th>bar<th>baz<th>zoo<tbody><tr><th>0<td>one<td>A<td>1<td>x<tr><th>1<td>one<td>B<td>2<td>y<tr><th>2<td>one<td>C<td>3<td>z<tr><th>3<td>two<td>A<td>4<td>q<tr><th>4<td>two<td>B<td>5<td>w<tr><th>5<td>two<td>C<td>6<td>t</table><div class=col-2-flex><table><thead><tr><th>bar<th>A<th>B<th>C<tr><th>foo<th><th><th><tbody><tr><th>one<td>1<td>2<td>3<tr><th>two<td>4<td>5<td>6</table><table><thead><tr><th>bar<th>A<th>B<th>C<tr><th>foo<th><th><th><tbody><tr><th>one<td>1<td>2<td>3<tr><th>two<td>4<td>5<td>6</table><table><thead><tr><th><th colspan=3 halign=left>baz<th colspan=3 halign=left>zoo<tr><th>bar<th>A<th>B<th>C<th>A<th>B<th>C<tr><th>foo<th><th><th><th><th><th><tbody><tr><th>one<td>1<td>2<td>3<td>x<td>y<td>z<tr><th>two<td>4<td>5<td>6<td>q<td>w<td>t</table></div><p>For one who wanna know <code>display_side_by_side</code>, check <a href=/jupyter-notebook#display-dataframes-side-by-side>this note</a>.<h2 id=change-shape-of-df-with-melt()>Change shape of df with <code>melt()</code> <a href=#change-shape-of-df-with-melt() class=direct-link>#</a></h2><p>Contrary to <code>pivot</code>, we now want to transform several columns into values of a single column,<sup><a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html target=_blank rel="noopener noreferrer">[ref]</a></sup><pre class=language-python><code class=language-python>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                   <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>df<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>display_side_by_side<span class="token punctuation">(</span>df<span class="token punctuation">,</span> df1<span class="token punctuation">,</span> df2<span class="token punctuation">)</span></code></pre><div class=col-2-flex><table><thead><tr><th><th>A<th>B<th>C<tbody><tr><th>0<td>a<td>1<td>2<tr><th>1<td>b<td>3<td>4<tr><th>2<td>c<td>5<td>6</table><table><thead><tr><th><th>A<th>variable<th>value<tbody><tr><th>0<td>a<td>B<td>1<tr><th>1<td>b<td>B<td>3<tr><th>2<td>c<td>B<td>5</table><table><thead><tr><th><th>A<th>variable<th>value<tbody><tr><th>0<td>a<td>B<td>1<tr><th>1<td>b<td>B<td>3<tr><th>2<td>c<td>B<td>5<tr><th>3<td>a<td>C<td>2<tr><th>4<td>b<td>C<td>4<tr><th>5<td>c<td>C<td>6</table></div><h2 id=references>References <a href=#references class=direct-link>#</a></h2><ul><li><a href=https://github.com/dinhanhthi/dataquest-aio/tree/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis>Data Cleaning and Analysis</a> on Dataquest.<li><a href=https://dinhanhthi.com/github-html?https://github.com/dinhanhthi/dataquest-aio/blob/master/step-2-data-analysis-and-visualization/course-4-data-cleaning-and-analysis/notebooks_in_html/task-3-transforming-data-with-pandas.html>Transforming data with pandas</a> on Dataquest.<li><strong>pandas official</strong> -- <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html>Group By: split-apply-combine</a></ul></div><script type=application/ld+json>{
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "Data Aggregation",
        "image": [],
        "author": "Anh-Thi DINH",
        "genre": "Insert a schema.org genre",
        "url": "https://dinhanhthi.com/data-aggregation/",
        "mainEntityOfPage": "https://dinhanhthi.com/data-aggregation/",
        "datePublished": "06-12-2019",
        "dateModified": "28-11-2020",
        "description": "In this note, I use df for DataFrame, s for Series. Libraries # import pandas as pd # import pandas packageimport numpy as np Dataframe #..."
      }</script></article></main><footer><a href=/ target=_blank>Thi Â Â©Â  2020 </a>Â â€¢Â  <a href=/about-the-notes/ >About the notes </a>Â â€¢Â  <a href=https://pobo.dinhanhthi.com target=_blank>Po Bo </a>Â â€¢Â  <a href=/for-me-only/ >For me only </a>Â â€¢Â  <a href=/donate/ >Support Thi</a></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js></script>