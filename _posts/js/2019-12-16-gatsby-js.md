---
layout: post
title: "Gatsby 101"
categories: [JavaScript]
icon-photo: gatsby.png
---

{% assign img-url = '/img/post/js' %}

{% include toc.html %}

{% notcomplete %}

{% updfreq %}

Jekyll is great but for a note-taking site like this site, it's slow. I decide to learn about Gatsby to make my note site more faster!

## To-do list

<div class="two-columns-list" markdown="1">
- [x] Deploy on localhost with a very basic site.
- [x] Understand the structure of Gatsby site/theme.
- [x] Try with a component of bootstrap on current layout.
- [x] Using `sass` in Gatsby (e.g. `main.scss` contains `_fonts.scss`,...).
- [x] Add `nav` to `Header.js`.
- [ ] Understand and add `base` layout.
- [ ] Understand and add `post` / `page` templates.
- [ ] Apply fully Bootstrap.
- [ ] Build index page first.
- [ ] Apply fully my own custom theme.
- [ ] Deploy on Github and Netlify.
- [ ] Add dark mode (read [this idea](https://www.gatsbyjs.org/blog/2019-01-31-using-react-context-api-with-gatsby/)).
</div>

## Misc

üëâ If you wanna install some additional plugins/components, remember to add `--save` at the end of the installation line. This step is to add to `package.json`.

~~~ bash
# for example
npm i gatsby-plugin-react-head react-head --save
~~~

üëâ React / Gatsby use [JSX](https://reactjs.org/docs/introducing-jsx.html) syntax. It's an XML/HTML-like syntax used by React that extends ECMAScript so that XML/HTML-like text can co-exist with JavaScript/React code.

## Installation on localhost

Install [npm](https://www.npmjs.com/) and [NodeJS (with npm)](https://nodejs.org/en/). Check the current version: `npm -v` (for npm) and `node -v` (for nodejs). After that, you can install Gatsby,

~~~ bash
# install
npm install --global gatsby-cli
# check version
gatsby -v
~~~

<div class="hide-show-box">
<button type="button" markdown="1" class="btn collapsed box-button" data-toggle="collapse" data-target="#box1ct">
If error `EACCES` occurs (fix on Linux)
</button>
<div id="box1ct" markdown="1" class="collapse multi-collapse box-content">

{:.pl-3}
- Create a new folder by: `mkdir ~/.npm-global`
- Open `~/.profile`
- Add following lines to this file

  ~~~ bash
  npm config set prefix '~/.npm-global'
  export PATH=~/.npm-global/bin:$PATH
  ~~~

- Save the file and then run (if you don't restart the computer, do the same below work for new tab of terminal): `source ~/.profile`.
</div>
</div>

Install new site with

~~~ bash
gatsby new gatsby-site # create a new site with name 'gatsby-site'
cd gatsby-site
gatsby develop # run the site at http://localhost:8000
~~~

You can view **GraphiQL**, an in-browser IDE, to explore your site's data and schema,

~~~ bash 
http://localhost:8000/___graphql
~~~

## Gatsby structure

- [Recipes](https://www.gatsbyjs.org/docs/recipes/) -- a cookbook on how to build things, Gatsby style.
- [Gatsby Project Structure](https://www.gatsbyjs.org/docs/gatsby-project-structure/) -- a tour of all the common folders and files.
- [Building with Components](https://www.gatsbyjs.org/docs/building-with-components/).
- [Layout Components](https://www.gatsbyjs.org/docs/layout-components/)

### Understand `props`

When React sees an element representing a user-defined component, it passes JSX attributes to this component as a single object. We call this object "props" (properties).{% ref https://reactjs.org/docs/components-and-props.html %}

### Components

A page is basically,

<div class="d-md-flex" markdown="1">
{:.flex-even.overflow-auto.pr-md-1}
~~~ jsx
import React from "react"
function AboutPage(props) {
  return (
    <div className="about-container">
      <p>About me.</p>
    </div>
  )
}

export default AboutPage
~~~

{:.flex-even.overflow-auto.pl-md-1}
~~~ jsx
import React from "react"
export default (props) => (
  return (
    // ...
  )
)

// or
const AboutPage = (props) => (
  // ...
)
export default AboutPage
~~~
</div>

## Apply Bootstrap

### Learn from Starter theme

üí° You can install a [Gatsby Bootstrap Starter](https://github.com/jaxx2104/gatsby-starter-bootstrap),

~~~ bash
gatsby new gatstrap https://github.com/jaxx2104/gatsby-starter-bootstrap
~~~

### Using plugins

‚ùì What if you wanna start from the beginning? üëâ Install `react-bootstrap` and `bootstrap`,

~~~ bash
npm install react-bootstrap bootstrap --save
# --save to save to package.json
~~~

Import below line in `/gatsby-browser.js`,

~~~ jsx
import 'bootstrap/dist/css/bootstrap.min.css';
~~~

### Using CDN from Bootstrap

‚ùì If you wanna use [CDN](https://getbootstrap.com/docs/4.4/getting-started/introduction/#quick-start)? üëâ Put below line in `<head>` by using [React Helmet](https://www.gatsbyjs.org/packages/gatsby-plugin-react-helmet/),

~~~ jsx
<Helmet>
  <link rel="stylesheet" href=".../bootstrap.min.css" integrity="..." crossorigin="anonymous" />
  <script src=".../jquery-3.4.1.slim.min.js" integrity="..." crossorigin="anonymous"></script>
  <script src=".../popper.js@1.16.0/dist/umd/popper.min.js" integrity="..." crossorigin="anonymous"></script>
  <script src=".../bootstrap.min.js" integrity="..." crossorigin="anonymous"></script>
</Helmet>
~~~

You can put above codes directly in your `layout.js` or `index.js`. All the `<link>` and `<script>` tags will be included in the `<head>`. For example in the file `src/pages/index.js`,

~~~ jsx
// src/pages/index.js
import Layout from "../layouts/layout"
import Helmet from "react-helmet"

const IndexPage = () => (
  <Layout>
    <Helmet>
      // the codes
    </Helmet>
    <h1>Hi people</h1>
    <p>Welcome to your new Gatsby site.</p>
    // other codes...
  </Layout>
)

export default IndexPage
~~~

‚ùì If you wanna put `bootstrap.js` in the `footer`? üëâ You can read [this tutorial](https://uxworks.online/how-to-add-a-script-in-head-or-body-tag-in-your-gatsby-website/) to add `<script>` / `<link>` tags in `<head>`, start or end of `<body>` tag. For example, in order to put above scripts/links before `</body>`, paste below code in `/gatsby-ssr.js`,

~~~ jsx
// file /gatsby-ssr.js
const React = require("react")
exports.onRenderBody = ({
  setHeadComponents,
  setPostBodyComponents,
}) => {
  setHeadComponents([
    <link 
      rel="stylesheet" 
      href=".../bootstrap.min.css" 
      integrity="..." 
      crossorigin="anonymous" 
    />,
  ])
  setPostBodyComponents([
    <script
      key="jquery-3-4-1"
      type="text/javascript"
      src=".../jquery-3.4.1.slim.min.js"
      integrity="..."
      crossorigin="anonymous"
    />,
    <script 
      key="proper-1-16"
      type="text/javascript"
      src=".../popper.js@1.16.0/dist/umd/popper.min.js" 
      integrity="..." 
      crossorigin="anonymous" 
    />,
    <script 
      key="bootstrap-js"
      type="text/javascript"
      src=".../bootstrap.min.js" 
      integrity="..." 
      crossorigin="anonymous" 
    />,
  ])
}
~~~

Remember to restart gatsby (<kbd>Ctrl</kbd> + <kbd>C</kbd> to stop and run `gatsby develop` to start again).

## Using `sass`

~~~ jsx
// in /scr/pages/index.js
import Layout from "../layouts/layout"

// in /scr/layouts/layout.js
import "../styles/main.scss"

// in /scr/styles/main.scss
@import "layout";

// in /scr/styles/_layout.scss
// scss codes
~~~

## Differences between `layouts` and `templates`

There are 2 separated folders `/src/layouts` and `/src/templates`.

- `layouts`: components are for everything shared across pages e.g. headers, footers, sidebars, etc.
- `templates`: components are for page types e.g. blog posts, documentation pages, etc. 

### Design `base` layout

What I need in the base layout:

- A fixed navigation bar on top.
- A fixed footer on bottom.
- A flexible header.
- A body wraper.

### Design `post` / `page` templates

Their differences are just the width of the container.

## Add `Navigation` bar

Using [`react-bootstrap`](https://react-bootstrap.netlify.com/), create a file `src/components/Navigation.js` whose content is,

~~~ jsx
import React from 'react'
import {Navbar, Nav, NavDropdown, Form, FormControl, Button} from 'react-bootstrap'

export default (props) => (
  // the codes from https://react-bootstrap.netlify.com/components/navbar/#navbars
)
~~~

Then, in `/src/Header.js`,

~~~ jsx
import Navigation from '../components/Navigation'

const Header = ({ siteTitle }) => (
  <header ..>
    <Navigation></Navigation>
    // other codes
  </header>
)
~~~

If you get stuck, check [this video](https://www.youtube.com/watch?v=fLCiSSu6-sI).

## References

- [Official documentation](https://www.gatsbyjs.org/docs/).
  - [Examples](https://github.com/gatsbyjs/gatsby/tree/master/examples).
  - **Gatsby Docs** -- [Tutorials (step-by-step)](https://www.gatsbyjs.org/tutorial/).
- **Nahuel Scotti** -- [Migrate from Jekyll to Gatsby](https://www.gatsbyjs.org/blog/2017-11-08-migrate-from-jekyll-to-gatsby/).
- [React Bootstrap](https://react-bootstrap.netlify.com/)
- [React Main Concepts](https://reactjs.org/docs/hello-world.html).
  - [JSX in depth](https://reactjs.org/docs/jsx-in-depth.html#user-defined-components-must-be-capitalized).
- **w3schools** -- [React Tutorial](https://www.w3schools.com/react/default.asp).
- [How to keep state between pages with local state in Gatsby.js](https://www.freecodecamp.org/news/keeping-state-between-pages-with-local-state-in-gatsby-js/)
- [`wrapRootElement` vs `wrapPageElement`](https://markoskon.com/notes/wrap-root-element-vs-wrap-page-element/)


