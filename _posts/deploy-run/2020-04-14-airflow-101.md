---
layout: post
title: "Airflow + Kubernetes 101"
categories: [deploy & run]
tags: ["deploy & run", "101", bash]
icon-photo: airflow.svg
notfull: 1
keywords: "airflow kubernetes k8s docker apache"
---

{% include toc.html %}

## Pods

- __Pod__: ([full](https://kubernetes.io/docs/concepts/workloads/pods/pod/)): a group of one or more containers (such as Docker containers), with shared storage/network, and a specification for how to run the containers.

<div class="flex-50" markdown="1">
``` bash
# list of pods
k get pods
```

``` bash
# enter a pod
k exec -it <pod_id> bash
```
</div>

## `KubernetesPodOperator`

- `task_id="abc_xyz"` (required): the name of task given in the airflow ui.
- `image="localhost:32000/airflow-abc:debug"` (required): docker image to use.
- `namespace="default"` (required, [ref](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/)):
- `in_cluster=True`:
- `trigger_rule="all_success"`: [ref](https://airflow.apache.org/docs/1.10.1/concepts.html?highlight=trigger_rule#trigger-rules)
- `image_pull_policy="Always"`: if you changes something on the docker image.

References:

- API document: [ref](https://airflow.apache.org/docs/1.10.1/kubernetes.html).
- [KubernetesPodOperator Configuration](https://cloud.google.com/composer/docs/how-to/using/using-kubernetes-pod-operator) -- Google Cloud.

## Airflow Branching

## Airflow Errors

ðŸ”… `ERROR - Exception when attempting to create Namespaced Pod.`

Note that if you don't use `in_cluster=True`, then you won't run into this problem.{% ref https://stackoverflow.com/questions/55498599/how-to-set-proper-permissions-to-run-kubernetespodoperator-in-cloud-composer %}

## References

- [Airflow official document](https://airflow.apache.org/docs/stable/).
- **kubernetes blog** -- [Airflow on Kubernetes](https://kubernetes.io/blog/2018/06/28/airflow-on-kubernetes-part-1-a-different-kind-of-operator/)