---
layout: post
title: "Docker 101"
categories: [deploy & run]
tags: [bash, ide, linux]
icon-photo: docker.png
notfull: 1
keywords: "pybash tania rascia CI CD continuous integration deployment pipeline docker idea how to use"
---

{% include toc.html %}

## What's Docker?

## Installation

### Windows

If meet the error `Failed to construct a huffman tree using the length array. The stream might be corrupted.`

1. You must have Windows 10: Pro, Enterprise, or Education (Build 15063 or later). Check [other requirements](https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install).
  ~~~ bash
# POWERSHELL
# check window version
Get-WmiObject -Class Win32_OperatingSystem | % Caption
# check window build number
Get-WmiObject -Class Win32_OperatingSystem | % Buildnumber
  ~~~
2. Active **Hyper-V** and **Containers** (you can do it manually in **Turn Windows features on or off**)
  ~~~ bash
# Open PowerShell with Administrator and run following
Enable-WindowsOptionalFeature -Online -FeatureName containers –All
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V –All
# restart
  ~~~
1. [Download](https://docs.docker.com/docker-for-windows/install/) and install.
2. Check `docker version`.
3. Try `docker run hello-world`.

## Login & Download images

- Download at [Docker Hub](https://hub.docker.com/). 
- Download images are store at `C:\ProgramData\DockerDesktop\vm-data` (Windows) by default.

## Delete

Read more [here](https://www.digitalocean.com/community/tutorials/how-to-remove-docker-images-containers-and-volumes).

### Everything
<div class="flex-50" markdown="1">
~~~ bash
# any resources
docker system prune
~~~

~~~ bash
# with all unused images
docker system prune -a
~~~
</div>

### Images

<div class="flex-50" markdown="1">
~~~ bash
# list all images
docker images -a 
~~~

~~~ bash
# remove a specific image
docker image rm <IMAGE ID>
~~~
</div>

Dangling images are layers that have no relationship to any tagged images.

<div class="flex-50" markdown="1">
~~~ bash
# list dangling images
docker images -f dangling=true
~~~

~~~ bash
# remove dangling images
docker images purge
~~~
</div>

### Containers

## Build an image

<div class="flex-50" markdown="1">
~~~ bash
# build image with Dockerfile
docker build -t <docker_name> .
~~~

~~~ bash
# with docker-compose
docker-compose up
~~~

~~~ bash
# if success
# service name "docker_thi"
docker run -it <service_name> bash
~~~
</div>

### `Dockerfile`

List of commands:

- `FROM`: the base image you use, can be obtained from [Docker Hub](https://hub.docker.com/). For example, `FROM ubuntu:18.04` (`18.04` is a tag, `latest` is default)
- `RUN`: install something, e.g. `RUN apt-get -y update`
- `WORKDIR`: change directory when you build the image (install this on that directory, for example).
- `CMD`: run the commands as docker launch from the image, it's remain while other run on launching. Only 1 (the last) can be executed.
- `ENTRYPOINT`: like `CMD` but you can override the command by others when launching.

### `docker-compose.yml`

Use to create various services with the same image.

### Example

Build an image ubuntu containing installed python and run jupyter notebook at the beginning.

<div class="flex-50" markdown="1">
~~~ bash
# base image
FROM ubuntu:18.04

# update & upgrade
RUN apt-get update && \
    apt-get -y upgrade && \
    apt-get install -y python3-pip python3-dev locales git

# install dependencies
COPY requirements.txt requirements.txt
RUN python3 -m pip install --upgrade pip && \
    python3 -m pip install -r requirements.txt
COPY . .

# default command
CMD [ "jupyter", "lab", "--no-browser", "--allow-root", "--ip=0.0.0.0"  ]

# Then run with `docker build -t docker_thi_img`
~~~

~~~ bash
# docker-compose.yml
# run by `docker-compose up`
version: '3'
services:
  dataswati:
    container_name: docker_thi
    image: docker_thi_img:latest
    ports:
      - "8888:8888"
    volumes:
      - "/local-folder/:/docker-folder/"
~~~
</div>

## Reference

- **Tania Rascia** -- [Building a Continuous Integration & Deployment Pipeline Using Docker (CI/CD)](https://www.taniarascia.com/continuous-integration-pipeline-docker/).
- **Microsoft** -- [Get started: Prep Windows for containers](https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/set-up-environment?tabs=Windows-Server) (Dockers on Win)
- **Docker** -- [Get started with Docker Compose](https://docs.docker.com/compose/gettingstarted/).
- **Linux Hint** -- [Understand Dockerfile](https://linuxhint.com/understand_dockerfile/).